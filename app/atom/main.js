let post_fetcher,contract_accounts;async function set_post_fetcher(){const e=get_profile_username();if(e){let t=await contract_accounts.id_by_username(e);post_fetcher=new PostFetcherProfile(t)}else post_fetcher=new PostFetcher}function get_profile_username(){const e=window.location.search;return new URLSearchParams(e).get("u")}async function load_posts_within_index_range(e,t){for(let n=e;n<=t;n++)post_fetcher.get_post(n).then((e=>{append_post_to_feed(e)}))}function readable_date_time_from_unix_timestamp(e){let t=new Date(1e3*e);return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+"/"+t.getDate()+" "+t.getFullYear()+", "+t.toTimeString().substr(0,5)}function generate_identicon_image(e){let t=new Identicon(e,{background:[255,255,255,255],size:40}).toString();return $("<img/>").attr("src","data:image/png;base64,"+t)}function generate_$post_meta(e,t){let n=readable_date_time_from_unix_timestamp(t);return $div_with_class("meta flex justify-between").append($("<a></a>").attr("href","?u="+e).addClass("author font-bold").text(e)).append($div_with_class("time text-gray-500 text-sm").text(n))}async function generate_$post(e){let t=$div_with_class("post bg-white p-5 rounded shadow-sm").css("order",-e.timestamp),n=generate_$post_meta(await contract_accounts.username_by_id(e.author),e.timestamp);return t.append(n),t.append($div_with_class("message break-words").text(e.message.substr(0,280))),t}function append_post_to_feed(e){generate_$post(e).then((e=>$("#feed #posts").append(e)))}function $div_with_class(e){return $("<div></div>").addClass(e)}function submit_post_input(){let e=$("#message"),t=e.val();return e.val(""),contract_posts.submit_post(t)}function update_feed(){post_fetcher.get_index_of_latest_post().then((e=>{let t=post_fetcher.get_index_of_last_post_fetched();e>t&&load_posts_within_index_range(t+1,e)}))}async function init_web3(){window.web3_initialized||(window.web3=await Moralis.enableWeb3(),window.web3_initialized=!0)}async function is_signed_up(){let e=await get_address();return contract_accounts.id_by_address(e).then((e=>parseInt(e)>0))}let contract_posts=new ContractPosts(CONFIG.contract_posts_address);async function get_username(){return get_address().then((e=>contract_accounts.id_by_address(e).then((e=>contract_accounts.username_by_id(e)))))}$(document).ready((async()=>{$("#overlay").load("./templates/overlay.html",(async()=>{close_screen_metamask_if_complete()&&await close_screen_network_if_complete()&&(contract_accounts=new ContractAccounts(await contract_posts.get_accounts_address()),await set_post_fetcher(),update_feed(),setInterval(update_feed,5e3),get_username().then((e=>{let t=get_profile_username();t&&e!==t&&($("#input").css("display","none"),$("#feed > .container").prepend($("<div class='text-center text-xl font-bold mb-5'></div>").addClass("profile_title").text(t))),$("#profile").attr("href","?u="+e)})),close_screen_signup_if_complete()),$("body").css("opacity","1")}))}));